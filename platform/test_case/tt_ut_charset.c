/*
 * import header files
 */
#include <tt_platform.h>

/*
 * local definition
 */

// === routine declarations ================
TT_TEST_ROUTINE_DECLARE(case_charset_gb2312_utf8)
TT_TEST_ROUTINE_DECLARE(case_charset_utf16le_utf8)
TT_TEST_ROUTINE_DECLARE(case_charset_utf16be_utf8)
TT_TEST_ROUTINE_DECLARE(case_charset_utf32le_utf8)
TT_TEST_ROUTINE_DECLARE(case_charset_utf32be_utf8)

TT_TEST_ROUTINE_DECLARE(case_charset_utf8)
// =========================================

// === test case list ======================
TT_TEST_CASE_LIST_DEFINE_BEGIN(charset_case)

TT_TEST_CASE("case_charset_gb2312_utf8",
             "testing charset: gb2312 <==> utf8",
             case_charset_gb2312_utf8,
             NULL,
             NULL,
             NULL,
             NULL,
             NULL)
, TT_TEST_CASE("case_charset_utf16le_utf8",
               "testing charset: utf16le <==> utf8",
               case_charset_utf16le_utf8,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL),
    TT_TEST_CASE("case_charset_utf16be_utf8",
                 "testing charset: utf16be <==> utf8",
                 case_charset_utf16be_utf8,
                 NULL,
                 NULL,
                 NULL,
                 NULL,
                 NULL),
    TT_TEST_CASE("case_charset_utf32le_utf8",
                 "testing charset: utf32le <==> utf8",
                 case_charset_utf32le_utf8,
                 NULL,
                 NULL,
                 NULL,
                 NULL,
                 NULL),
    TT_TEST_CASE("case_charset_utf32be_utf8",
                 "testing charset: utf32be <==> utf8",
                 case_charset_utf32be_utf8,
                 NULL,
                 NULL,
                 NULL,
                 NULL,
                 NULL),

    TT_TEST_CASE("case_charset_utf8",
                 "testing charset: utf8",
                 case_charset_utf8,
                 NULL,
                 NULL,
                 NULL,
                 NULL,
                 NULL),

    TT_TEST_CASE_LIST_DEFINE_END(charset_case)
    // =========================================

    TT_TEST_UNIT_DEFINE(TEST_UNIT_CHARSET, 0, charset_case)

    /*
     * interface implementation
     */


    /*
    TT_TEST_ROUTINE_DEFINE(case_charset_utf8)
    {
        //tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);

        TT_TEST_CASE_ENTER()
        // test start

        // test end
        TT_TEST_CASE_LEAVE()
    }
    */

    static tt_u8_t __gb2312_1[] = {
        0xCD, 0xF8, 0xD2, 0xD7, 0xBF, 0xC6, 0xBC, 0xBC, 0xD1, 0xB6, 0x20, 0x39,
        0xD4, 0xC2, 0x31, 0x37, 0xC8, 0xD5, 0xCF, 0xFB, 0xCF, 0xA2, 0xA3, 0xAC,
        0xCD, 0xF8, 0xD2, 0xD7, 0xBF, 0xC6, 0xBC, 0xBC, 0xB4, 0xD3, 0xD3, 0xEE,
        0xC1, 0xFA, 0xBF, 0xE1, 0xC5, 0xC9, 0xC4, 0xDA, 0xB2, 0xBF, 0xBB, 0xF1,
        0xCF, 0xA4, 0xA3, 0xAC, 0xBF, 0xE1, 0xC5, 0xC9, 0xBD, 0xAB, 0xC1, 0xAA,
        0xBA, 0xCF, 0xC7, 0xFE, 0xB5, 0xC0, 0xC9, 0xCC, 0xCD, 0xB6, 0xD7, 0xCA,
        0x31, 0x30, 0xD2, 0xDA, 0xD4, 0xAA, 0xD7, 0xE9, 0xBD, 0xA8, 0xBA, 0xCF,
        0xD7, 0xCA, 0xB9, 0xAB, 0xCB, 0xBE, 0xA3, 0xAC, 0xBC, 0xD3, 0xCB, 0xD9,
        0xB2, 0xBC, 0xBE, 0xD6, 0xC9, 0xE7, 0xBB, 0xE1, 0xB9, 0xAB, 0xBF, 0xAA,
        0xC7, 0xFE, 0xB5, 0xC0, 0xA3, 0xAC, 0xBD, 0xA8, 0xC1, 0xA2, 0xB3, 0xA7,
        0xC9, 0xCC, 0xD2, 0xBB, 0xCC, 0xE5, 0xBB, 0xAF, 0xC7, 0xFE, 0xB5, 0xC0,
        0xD4, 0xCB, 0xD3, 0xAA, 0xD0, 0xC2, 0xC4, 0xA3, 0xCA, 0xBD, 0xA1, 0xA3,
        0x0D, 0x0A, 0x0D, 0x0A, 0xC4, 0xBF, 0xC7, 0xB0, 0xA3, 0xAC, 0xD5, 0xE2,
        0xB8, 0xF6, 0xBA, 0xCF, 0xD7, 0xCA, 0xB9, 0xAB, 0xCB, 0xBE, 0xBB, 0xB9,
        0xB4, 0xA6, 0xD3, 0xDA, 0xB3, 0xEF, 0xB1, 0xB8, 0xBD, 0xD7, 0xB6, 0xCE,
        0xA3, 0xAC, 0xB9, 0xD8, 0xD3, 0xDA, 0xB9, 0xAB, 0xCB, 0xBE, 0xC3, 0xFB,
        0xB3, 0xC6, 0xA1, 0xA2, 0xB8, 0xBA, 0xD4, 0xF0, 0xC8, 0xCB, 0xA1, 0xA2,
        0xD5, 0xFD, 0xCA, 0xBD, 0xB3, 0xC9, 0xC1, 0xA2, 0xB5, 0xC4, 0xCA, 0xB1,
        0xBC, 0xE4, 0xA1, 0xA2, 0xBA, 0xCF, 0xD7, 0xF7, 0xB7, 0xBD, 0xB5, 0xC8,
        0xCF, 0xB8, 0xBD, 0xDA, 0xA3, 0xAC, 0xBB, 0xB9, 0xCE, 0xB4, 0xB1, 0xBB,
        0xCD, 0xB8, 0xC2, 0xB6, 0xA1, 0xA3, 0x0D, 0x0A, 0x0D, 0x0A, 0xBF, 0xE1,
        0xC5, 0xC9, 0xB7, 0xBD, 0xC3, 0xE6, 0xB3, 0xC6, 0xA3, 0xAC, 0xB8, 0xC3,
        0xB9, 0xAB, 0xCB, 0xBE, 0xC1, 0xAA, 0xBA, 0xCF, 0xC7, 0xFE, 0xB5, 0xC0,
        0xC9, 0xCC, 0xB9, 0xB2, 0xCD, 0xAC, 0xCD, 0xB6, 0xD7, 0xCA, 0xB2, 0xCE,
        0xB9, 0xC9, 0xA1, 0xA2, 0xB3, 0xC9, 0xC1, 0xA2, 0xBA, 0xCF, 0xD7, 0xCA,
        0xB9, 0xAB, 0xCB, 0xBE, 0xA3, 0xAC, 0xD4, 0xDA, 0xD2, 0xBB, 0xB6, 0xA8,
        0xB3, 0xCC, 0xB6, 0xC8, 0xC9, 0xCF, 0xCA, 0xC7, 0xBB, 0xF9, 0xD3, 0xDA,
        0xC4, 0xBF, 0xC7, 0xB0, 0xD4, 0xCB, 0xD3, 0xAA, 0xC9, 0xCC, 0xB2, 0xB9,
        0xCC, 0xF9, 0xC1, 0xA6, 0xB6, 0xC8, 0xCF, 0xC2, 0xB5, 0xF7, 0xB5, 0xC8,
        0xD5, 0xFE, 0xB2, 0xDF, 0xB1, 0xE4, 0xBB, 0xAF, 0xCF, 0xC2, 0xB5, 0xC4,
        0xD3, 0xA6, 0xB6, 0xD4, 0xBE, 0xD9, 0xB4, 0xEB, 0xA1, 0xA3, 0x0D, 0x0A,
        0x0D, 0x0A, 0xD3, 0xEB, 0xBA, 0xA3, 0xCD, 0xE2, 0xCA, 0xD0, 0xB3, 0xA1,
        0xCF, 0xE0, 0xB1, 0xC8, 0xA3, 0xAC, 0xD6, 0xD0, 0xB9, 0xFA, 0xB5, 0xC4,
};

static tt_u8_t __utf8_1[] = {
    0xE7, 0xBD, 0x91, 0xE6, 0x98, 0x93, 0xE7, 0xA7, 0x91, 0xE6, 0x8A, 0x80,
    0xE8, 0xAE, 0xAF, 0x20, 0x39, 0xE6, 0x9C, 0x88, 0x31, 0x37, 0xE6, 0x97,
    0xA5, 0xE6, 0xB6, 0x88, 0xE6, 0x81, 0xAF, 0xEF, 0xBC, 0x8C, 0xE7, 0xBD,
    0x91, 0xE6, 0x98, 0x93, 0xE7, 0xA7, 0x91, 0xE6, 0x8A, 0x80, 0xE4, 0xBB,
    0x8E, 0xE5, 0xAE, 0x87, 0xE9, 0xBE, 0x99, 0xE9, 0x85, 0xB7, 0xE6, 0xB4,
    0xBE, 0xE5, 0x86, 0x85, 0xE9, 0x83, 0xA8, 0xE8, 0x8E, 0xB7, 0xE6, 0x82,
    0x89, 0xEF, 0xBC, 0x8C, 0xE9, 0x85, 0xB7, 0xE6, 0xB4, 0xBE, 0xE5, 0xB0,
    0x86, 0xE8, 0x81, 0x94, 0xE5, 0x90, 0x88, 0xE6, 0xB8, 0xA0, 0xE9, 0x81,
    0x93, 0xE5, 0x95, 0x86, 0xE6, 0x8A, 0x95, 0xE8, 0xB5, 0x84, 0x31, 0x30,
    0xE4, 0xBA, 0xBF, 0xE5, 0x85, 0x83, 0xE7, 0xBB, 0x84, 0xE5, 0xBB, 0xBA,
    0xE5, 0x90, 0x88, 0xE8, 0xB5, 0x84, 0xE5, 0x85, 0xAC, 0xE5, 0x8F, 0xB8,
    0xEF, 0xBC, 0x8C, 0xE5, 0x8A, 0xA0, 0xE9, 0x80, 0x9F, 0xE5, 0xB8, 0x83,
    0xE5, 0xB1, 0x80, 0xE7, 0xA4, 0xBE, 0xE4, 0xBC, 0x9A, 0xE5, 0x85, 0xAC,
    0xE5, 0xBC, 0x80, 0xE6, 0xB8, 0xA0, 0xE9, 0x81, 0x93, 0xEF, 0xBC, 0x8C,
    0xE5, 0xBB, 0xBA, 0xE7, 0xAB, 0x8B, 0xE5, 0x8E, 0x82, 0xE5, 0x95, 0x86,
    0xE4, 0xB8, 0x80, 0xE4, 0xBD, 0x93, 0xE5, 0x8C, 0x96, 0xE6, 0xB8, 0xA0,
    0xE9, 0x81, 0x93, 0xE8, 0xBF, 0x90, 0xE8, 0x90, 0xA5, 0xE6, 0x96, 0xB0,
    0xE6, 0xA8, 0xA1, 0xE5, 0xBC, 0x8F, 0xE3, 0x80, 0x82, 0x0D, 0x0A, 0x0D,
    0x0A, 0xE7, 0x9B, 0xAE, 0xE5, 0x89, 0x8D, 0xEF, 0xBC, 0x8C, 0xE8, 0xBF,
    0x99, 0xE4, 0xB8, 0xAA, 0xE5, 0x90, 0x88, 0xE8, 0xB5, 0x84, 0xE5, 0x85,
    0xAC, 0xE5, 0x8F, 0xB8, 0xE8, 0xBF, 0x98, 0xE5, 0xA4, 0x84, 0xE4, 0xBA,
    0x8E, 0xE7, 0xAD, 0xB9, 0xE5, 0xA4, 0x87, 0xE9, 0x98, 0xB6, 0xE6, 0xAE,
    0xB5, 0xEF, 0xBC, 0x8C, 0xE5, 0x85, 0xB3, 0xE4, 0xBA, 0x8E, 0xE5, 0x85,
    0xAC, 0xE5, 0x8F, 0xB8, 0xE5, 0x90, 0x8D, 0xE7, 0xA7, 0xB0, 0xE3, 0x80,
    0x81, 0xE8, 0xB4, 0x9F, 0xE8, 0xB4, 0xA3, 0xE4, 0xBA, 0xBA, 0xE3, 0x80,
    0x81, 0xE6, 0xAD, 0xA3, 0xE5, 0xBC, 0x8F, 0xE6, 0x88, 0x90, 0xE7, 0xAB,
    0x8B, 0xE7, 0x9A, 0x84, 0xE6, 0x97, 0xB6, 0xE9, 0x97, 0xB4, 0xE3, 0x80,
    0x81, 0xE5, 0x90, 0x88, 0xE4, 0xBD, 0x9C, 0xE6, 0x96, 0xB9, 0xE7, 0xAD,
    0x89, 0xE7, 0xBB, 0x86, 0xE8, 0x8A, 0x82, 0xEF, 0xBC, 0x8C, 0xE8, 0xBF,
    0x98, 0xE6, 0x9C, 0xAA, 0xE8, 0xA2, 0xAB, 0xE9, 0x80, 0x8F, 0xE9, 0x9C,
    0xB2, 0xE3, 0x80, 0x82, 0x0D, 0x0A, 0x0D, 0x0A, 0xE9, 0x85, 0xB7, 0xE6,
    0xB4, 0xBE, 0xE6, 0x96, 0xB9, 0xE9, 0x9D, 0xA2, 0xE7, 0xA7, 0xB0, 0xEF,
    0xBC, 0x8C, 0xE8, 0xAF, 0xA5, 0xE5, 0x85, 0xAC, 0xE5, 0x8F, 0xB8, 0xE8,
    0x81, 0x94, 0xE5, 0x90, 0x88, 0xE6, 0xB8, 0xA0, 0xE9, 0x81, 0x93, 0xE5,
    0x95, 0x86, 0xE5, 0x85, 0xB1, 0xE5, 0x90, 0x8C, 0xE6, 0x8A, 0x95, 0xE8,
    0xB5, 0x84, 0xE5, 0x8F, 0x82, 0xE8, 0x82, 0xA1, 0xE3, 0x80, 0x81, 0xE6,
    0x88, 0x90, 0xE7, 0xAB, 0x8B, 0xE5, 0x90, 0x88, 0xE8, 0xB5, 0x84, 0xE5,
    0x85, 0xAC, 0xE5, 0x8F, 0xB8, 0xEF, 0xBC, 0x8C, 0xE5, 0x9C, 0xA8, 0xE4,
    0xB8, 0x80, 0xE5, 0xAE, 0x9A, 0xE7, 0xA8, 0x8B, 0xE5, 0xBA, 0xA6, 0xE4,
    0xB8, 0x8A, 0xE6, 0x98, 0xAF, 0xE5, 0x9F, 0xBA, 0xE4, 0xBA, 0x8E, 0xE7,
    0x9B, 0xAE, 0xE5, 0x89, 0x8D, 0xE8, 0xBF, 0x90, 0xE8, 0x90, 0xA5, 0xE5,
    0x95, 0x86, 0xE8, 0xA1, 0xA5, 0xE8, 0xB4, 0xB4, 0xE5, 0x8A, 0x9B, 0xE5,
    0xBA, 0xA6, 0xE4, 0xB8, 0x8B, 0xE8, 0xB0, 0x83, 0xE7, 0xAD, 0x89, 0xE6,
    0x94, 0xBF, 0xE7, 0xAD, 0x96, 0xE5, 0x8F, 0x98, 0xE5, 0x8C, 0x96, 0xE4,
    0xB8, 0x8B, 0xE7, 0x9A, 0x84, 0xE5, 0xBA, 0x94, 0xE5, 0xAF, 0xB9, 0xE4,
    0xB8, 0xBE, 0xE6, 0x8E, 0xAA, 0xE3, 0x80, 0x82, 0x0D, 0x0A, 0x0D, 0x0A,
    0xE4, 0xB8, 0x8E, 0xE6, 0xB5, 0xB7, 0xE5, 0xA4, 0x96, 0xE5, 0xB8, 0x82,
    0xE5, 0x9C, 0xBA, 0xE7, 0x9B, 0xB8, 0xE6, 0xAF, 0x94, 0xEF, 0xBC, 0x8C,
    0xE4, 0xB8, 0xAD, 0xE5, 0x9B, 0xBD, 0xE7, 0x9A, 0x84,
};

TT_TEST_ROUTINE_DEFINE(case_charset_gb2312_utf8)
{
    // tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);
    tt_result_t ret;
    tt_chsetconv_t csconv;
    tt_u8_t buf[10];
    tt_u32_t buf_len;

    TT_TEST_CASE_ENTER()
// test start

#if TT_ENV_OS_IS_ANDROID
    return TT_SUCCESS;
#endif

    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_GB2312, TT_CHARSET_UTF8, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");

    ret = tt_chsetconv_input(&csconv, __gb2312_1, 0);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");

    buf_len = 0;
    tt_chsetconv_output(&csconv, buf, &buf_len);
    TT_UT_EQUAL(buf_len, 0, "");

    tt_chsetconv_output_ptr(&csconv, NULL, &buf_len);
    TT_UT_EQUAL(buf_len, 0, "");

    tt_chsetconv_destroy(&csconv);
    ;

    // gb2312 to utf8
    {
        tt_u8_t ret_utf8[sizeof(__utf8_1)];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8);

        ret = tt_chsetconv_create(&csconv,
                                  TT_CHARSET_GB2312,
                                  TT_CHARSET_UTF8,
                                  NULL);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        ret = tt_chsetconv_input(&csconv, __gb2312_1, sizeof(__gb2312_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, NULL, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, sizeof(__utf8_1), "");

        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, sizeof(__utf8_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf8, __utf8_1, ret_utf8_len), 0, "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_destroy(&csconv);
    }

    // utf8 to gb2312
    {
        tt_u8_t *ret_gb2312;
        tt_u32_t ret_gb2312_len;

        ret = tt_chsetconv_create(&csconv,
                                  TT_CHARSET_UTF8,
                                  TT_CHARSET_GB2312,
                                  NULL);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        ret = tt_chsetconv_input(&csconv, __utf8_1, sizeof(__utf8_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output_ptr(&csconv, NULL, &ret_gb2312_len);
        TT_UT_EQUAL(ret_gb2312_len, sizeof(__gb2312_1), "");

        tt_chsetconv_output_ptr(&csconv, &ret_gb2312, &ret_gb2312_len);
        TT_UT_EQUAL(ret_gb2312_len, sizeof(__gb2312_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_gb2312, __gb2312_1, ret_gb2312_len), 0, "");

        // can get again
        tt_chsetconv_output_ptr(&csconv, NULL, &ret_gb2312_len);
        TT_UT_EQUAL(ret_gb2312_len, sizeof(__gb2312_1), "");

        tt_chsetconv_output_ptr(&csconv, &ret_gb2312, &ret_gb2312_len);
        TT_UT_EQUAL(ret_gb2312_len, sizeof(__gb2312_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_gb2312, __gb2312_1, ret_gb2312_len), 0, "");

        tt_chsetconv_destroy(&csconv);
    }

    // test end
    TT_TEST_CASE_LEAVE()
}

static tt_u8_t __utf16le_1[] =
    {0x51, 0x7f, 0x13, 0x66, 0xd1, 0x79, 0x80, 0x62, 0xaf, 0x8b, 0x20, 0x00,
     0x39, 0x00, 0x08, 0x67, 0x31, 0x00, 0x37, 0x00, 0xe5, 0x65, 0x88, 0x6d,
     0x6f, 0x60, 0x0c, 0xff, 0x51, 0x7f, 0x13, 0x66, 0xd1, 0x79, 0x80, 0x62,
     0xce, 0x4e, 0x87, 0x5b, 0x99, 0x9f, 0x77, 0x91, 0x3e, 0x6d, 0x85, 0x51,
     0xe8, 0x90, 0xb7, 0x83, 0x89, 0x60, 0x0c, 0xff, 0x77, 0x91, 0x3e, 0x6d,
     0x06, 0x5c, 0x54, 0x80, 0x08, 0x54, 0x20, 0x6e, 0x53, 0x90, 0x46, 0x55,
     0x95, 0x62, 0x44, 0x8d, 0x31, 0x00, 0x30, 0x00, 0xbf, 0x4e, 0x43, 0x51,
     0xc4, 0x7e, 0xfa, 0x5e, 0x08, 0x54, 0x44, 0x8d, 0x6c, 0x51, 0xf8, 0x53,
     0x0c, 0xff, 0xa0, 0x52, 0x1f, 0x90, 0x03, 0x5e, 0x40, 0x5c, 0x3e, 0x79,
     0x1a, 0x4f, 0x6c, 0x51, 0x00, 0x5f, 0x20, 0x6e, 0x53, 0x90, 0x0c, 0xff,
     0xfa, 0x5e, 0xcb, 0x7a, 0x82, 0x53, 0x46, 0x55, 0x00, 0x4e, 0x53, 0x4f,
     0x16, 0x53, 0x20, 0x6e, 0x53, 0x90, 0xd0, 0x8f, 0x25, 0x84, 0xb0, 0x65,
     0x21, 0x6a, 0x0f, 0x5f, 0x02, 0x30, 0x0d, 0x00, 0x0a, 0x00, 0x0d, 0x00,
     0x0a, 0x00, 0xee, 0x76, 0x4d, 0x52, 0x0c, 0xff, 0xd9, 0x8f, 0x2a, 0x4e,
     0x08, 0x54, 0x44, 0x8d, 0x6c, 0x51, 0xf8, 0x53, 0xd8, 0x8f, 0x04, 0x59,
     0x8e, 0x4e, 0x79, 0x7b, 0x07, 0x59, 0x36, 0x96, 0xb5, 0x6b, 0x0c, 0xff,
     0x73, 0x51, 0x8e, 0x4e, 0x6c, 0x51, 0xf8, 0x53, 0x0d, 0x54, 0xf0, 0x79,
     0x01, 0x30, 0x1f, 0x8d, 0x23, 0x8d, 0xba, 0x4e, 0x01, 0x30, 0x63, 0x6b,
     0x0f, 0x5f, 0x10, 0x62, 0xcb, 0x7a, 0x84, 0x76, 0xf6, 0x65, 0xf4, 0x95,
     0x01, 0x30, 0x08, 0x54, 0x5c, 0x4f, 0xb9, 0x65, 0x49, 0x7b, 0xc6, 0x7e,
     0x82, 0x82, 0x0c, 0xff, 0xd8, 0x8f, 0x2a, 0x67, 0xab, 0x88, 0x0f, 0x90,
     0x32, 0x97, 0x02, 0x30, 0x0d, 0x00, 0x0a, 0x00, 0x0d, 0x00, 0x0a, 0x00,
     0x77, 0x91, 0x3e, 0x6d, 0xb9, 0x65, 0x62, 0x97, 0xf0, 0x79, 0x0c, 0xff,
     0xe5, 0x8b, 0x6c, 0x51, 0xf8, 0x53, 0x54, 0x80, 0x08, 0x54, 0x20, 0x6e,
     0x53, 0x90, 0x46, 0x55, 0x71, 0x51, 0x0c, 0x54, 0x95, 0x62, 0x44, 0x8d,
     0xc2, 0x53, 0xa1, 0x80, 0x01, 0x30, 0x10, 0x62, 0xcb, 0x7a, 0x08, 0x54,
     0x44, 0x8d, 0x6c, 0x51, 0xf8, 0x53, 0x0c, 0xff, 0x28, 0x57, 0x00, 0x4e,
     0x9a, 0x5b, 0x0b, 0x7a, 0xa6, 0x5e, 0x0a, 0x4e, 0x2f, 0x66, 0xfa, 0x57,
     0x8e, 0x4e, 0xee, 0x76, 0x4d, 0x52, 0xd0, 0x8f, 0x25, 0x84, 0x46, 0x55,
     0x65, 0x88, 0x34, 0x8d, 0x9b, 0x52, 0xa6, 0x5e, 0x0b, 0x4e, 0x03, 0x8c,
     0x49, 0x7b, 0x3f, 0x65, 0x56, 0x7b, 0xd8, 0x53, 0x16, 0x53, 0x0b, 0x4e,
     0x84, 0x76, 0x94, 0x5e, 0xf9, 0x5b, 0x3e, 0x4e, 0xaa, 0x63, 0x02, 0x30,
     0x0d, 0x00, 0x0a, 0x00, 0x0d, 0x00, 0x0a, 0x00, 0x0e, 0x4e, 0x77, 0x6d,
     0x16, 0x59, 0x02, 0x5e, 0x3a, 0x57, 0xf8, 0x76, 0xd4, 0x6b, 0x0c, 0xff,
     0x2d, 0x4e, 0xfd, 0x56, 0x84, 0x76};

TT_TEST_ROUTINE_DEFINE(case_charset_utf16le_utf8)
{
    // tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);
    tt_result_t ret;
    tt_chsetconv_t csconv;

    TT_TEST_CASE_ENTER()
// test start

#if TT_ENV_OS_IS_ANDROID
    return TT_SUCCESS;
#endif

    // utf16le to utf8
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF16LE, TT_CHARSET_UTF8, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf8[sizeof(__utf8_1) + 100];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8);

        ret = tt_chsetconv_input(&csconv, __utf16le_1, sizeof(__utf16le_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, sizeof(__utf8_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf8, __utf8_1, ret_utf8_len), 0, "");

        // no more
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }

    // utf16le to utf8: incomplete
    {
        tt_u8_t test_1[] = {0x51,
                            0x7f,
                            0x13,
                            0x66,
                            0xd1,
                            0x79,
                            0x80,
                            0x62,
                            0x01,
                            0xD8,
                            0x37,
                            0xDC,
                            0xaf,
                            0x8b};
        tt_u8_t test_ret[] = {0xe7,
                              0xbd,
                              0x91,
                              0xe6,
                              0x98,
                              0x93,
                              0xe7,
                              0xa7,
                              0x91,
                              0xe6,
                              0x8a,
                              0x80,
                              0xf0,
                              0x90,
                              0x90,
                              0xb7,
                              0xe8,
                              0xae,
                              0xaf};
        tt_u8_t ret_utf8[10];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8), i, j;

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 1 utf8
        ret = tt_chsetconv_input(&csconv, test_1 + 1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xBd, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");

        // 1 utf8
        ret = tt_chsetconv_input(&csconv, test_1 + 2, 3);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe6, "");
        TT_UT_EQUAL(ret_utf8[1], 0x98, "");
        TT_UT_EQUAL(ret_utf8[2], 0x93, "");

        // 2 utf8
        ret = tt_chsetconv_input(&csconv, test_1 + 5, 4);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 6, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xA7, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");
        TT_UT_EQUAL(ret_utf8[3], 0xe6, "");
        TT_UT_EQUAL(ret_utf8[4], 0x8A, "");
        TT_UT_EQUAL(ret_utf8[5], 0x80, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1 + 9, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        ret = tt_chsetconv_input(&csconv, test_1 + 10, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 2 utf
        ret = tt_chsetconv_input(&csconv, test_1 + 11, 3);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 7, "");
        TT_UT_EQUAL(ret_utf8[0], 0xF0, "");
        TT_UT_EQUAL(ret_utf8[1], 0x90, "");
        TT_UT_EQUAL(ret_utf8[2], 0x90, "");
        TT_UT_EQUAL(ret_utf8[3], 0xB7, "");
        TT_UT_EQUAL(ret_utf8[4], 0xe8, "");
        TT_UT_EQUAL(ret_utf8[5], 0xAE, "");
        TT_UT_EQUAL(ret_utf8[6], 0xAF, "");

        // no more
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);

        // random test
        i = 0;
        j = 0;
        while (i < sizeof(test_1)) {
            tt_u32_t n = tt_rand_u32() % 3 + 1;
            if (i + n > sizeof(test_1)) {
                n = sizeof(test_1) - i;
            }

            ret = tt_chsetconv_input(&csconv, test_1 + i, n);
            TT_UT_EQUAL(ret, TT_SUCCESS, "");

            ret_utf8_len = sizeof(ret_utf8);
            tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
            if (ret_utf8_len != 0) {
                TT_UT_EQUAL(tt_memcmp(ret_utf8, test_ret + j, ret_utf8_len),
                            0,
                            "");
                j += ret_utf8_len;
            }

            i += n;
        }

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // utf8 to utf16le
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF8, TT_CHARSET_UTF16LE, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf16le[100];
        tt_u32_t ret_utf16le_len;
        tt_u32_t n;
        tt_u8_t *p;

        ret = tt_chsetconv_input(&csconv, __utf8_1, sizeof(__utf8_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        ret_utf16le_len = 0;
        tt_chsetconv_output(&csconv, ret_utf16le, &ret_utf16le_len);
        TT_UT_EQUAL(ret_utf16le_len, 0, "");

        n = 0;
        while (n < sizeof(__utf16le_1)) {
            ret_utf16le_len = sizeof(ret_utf16le);
            tt_chsetconv_output(&csconv, ret_utf16le, &ret_utf16le_len);
            TT_UT_EXP(ret_utf16le_len <= sizeof(ret_utf16le), "");
            TT_UT_EQUAL(tt_memcmp(ret_utf16le,
                                  __utf16le_1 + n,
                                  ret_utf16le_len),
                        0,
                        "");

            n += ret_utf16le_len;
        }
        TT_UT_EQUAL(n, sizeof(__utf16le_1), "");

        // no more
        ret_utf16le_len = sizeof(ret_utf16le);
        tt_chsetconv_output(&csconv, ret_utf16le, &ret_utf16le_len);
        TT_UT_EQUAL(ret_utf16le_len, 0, "");

        ret_utf16le_len = sizeof(ret_utf16le);
        tt_chsetconv_output_ptr(&csconv, &p, &ret_utf16le_len);
        TT_UT_EQUAL(p, NULL, "");
        TT_UT_EQUAL(ret_utf16le_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }

    // utf8 to utf16le: incomplete utf16le
    {
        tt_u8_t utf8_test1[] = {0xe7,
                                0xbd,
                                0x91,
                                0xe6,
                                0x98,
                                0x93,
                                0xE7,
                                0xA7,
                                0x91,
                                0xf0,
                                0x90,
                                0x90,
                                0xb7,
                                0XE6};
        tt_u8_t test_ret[] =
            {0x51, 0x7f, 0x13, 0x66, 0xd1, 0x79, 0x01, 0xd8, 0x37, 0xdc};
        tt_u8_t ret_utf8[10];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8), i, j;

        // not ready
        ret = tt_chsetconv_input(&csconv, utf8_test1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, utf8_test1 + 1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 1 utf16le
        ret = tt_chsetconv_input(&csconv, utf8_test1 + 2, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 2, "");
        TT_UT_EQUAL(ret_utf8[0], 0X51, "");
        TT_UT_EQUAL(ret_utf8[1], 0x7F, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, utf8_test1 + 3, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 2 utf16le
        ret = tt_chsetconv_input(&csconv, utf8_test1 + 5, 5);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 4, "");
        TT_UT_EQUAL(ret_utf8[0], 0X13, "");
        TT_UT_EQUAL(ret_utf8[1], 0x66, "");
        TT_UT_EQUAL(ret_utf8[2], 0XD1, "");
        TT_UT_EQUAL(ret_utf8[3], 0x79, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, utf8_test1 + 10, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        ret = tt_chsetconv_input(&csconv, utf8_test1 + 11, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 1 utf16
        ret = tt_chsetconv_input(&csconv, utf8_test1 + 12, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 4, "");
        TT_UT_EQUAL(ret_utf8[0], 0X01, "");
        TT_UT_EQUAL(ret_utf8[1], 0xD8, "");
        TT_UT_EQUAL(ret_utf8[2], 0X37, "");
        TT_UT_EQUAL(ret_utf8[3], 0xDC, "");

        // no more
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);

        // random test
        i = 0;
        j = 0;
        while (i < sizeof(utf8_test1)) {
            tt_u32_t n = tt_rand_u32() % 3 + 1;
            if (i + n > sizeof(utf8_test1)) {
                n = sizeof(utf8_test1) - i;
            }

            ret = tt_chsetconv_input(&csconv, utf8_test1 + i, n);
            TT_UT_EQUAL(ret, TT_SUCCESS, "");

            ret_utf8_len = sizeof(ret_utf8);
            tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
            if (ret_utf8_len != 0) {
                TT_UT_EQUAL(tt_memcmp(ret_utf8, test_ret + j, ret_utf8_len),
                            0,
                            "");
                j += ret_utf8_len;
            }

            i += n;
        }

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // test end
    TT_TEST_CASE_LEAVE()
}

static tt_u8_t __utf16be_1[] =
    {0x7f, 0x51, 0x66, 0x13, 0x79, 0xd1, 0x62, 0x80, 0x8b, 0xaf, 0x00, 0x20,
     0x00, 0x39, 0x67, 0x08, 0x00, 0x31, 0x00, 0x37, 0x65, 0xe5, 0x6d, 0x88,
     0x60, 0x6f, 0xff, 0x0c, 0x7f, 0x51, 0x66, 0x13, 0x79, 0xd1, 0x62, 0x80,
     0x4e, 0xce, 0x5b, 0x87, 0x9f, 0x99, 0x91, 0x77, 0x6d, 0x3e, 0x51, 0x85,
     0x90, 0xe8, 0x83, 0xb7, 0x60, 0x89, 0xff, 0x0c, 0x91, 0x77, 0x6d, 0x3e,
     0x5c, 0x06, 0x80, 0x54, 0x54, 0x08, 0x6e, 0x20, 0x90, 0x53, 0x55, 0x46,
     0x62, 0x95, 0x8d, 0x44, 0x00, 0x31, 0x00, 0x30, 0x4e, 0xbf, 0x51, 0x43,
     0x7e, 0xc4, 0x5e, 0xfa, 0x54, 0x08, 0x8d, 0x44, 0x51, 0x6c, 0x53, 0xf8,
     0xff, 0x0c, 0x52, 0xa0, 0x90, 0x1f, 0x5e, 0x03, 0x5c, 0x40, 0x79, 0x3e,
     0x4f, 0x1a, 0x51, 0x6c, 0x5f, 0x00, 0x6e, 0x20, 0x90, 0x53, 0xff, 0x0c,
     0x5e, 0xfa, 0x7a, 0xcb, 0x53, 0x82, 0x55, 0x46, 0x4e, 0x00, 0x4f, 0x53,
     0x53, 0x16, 0x6e, 0x20, 0x90, 0x53, 0x8f, 0xd0, 0x84, 0x25, 0x65, 0xb0,
     0x6a, 0x21, 0x5f, 0x0f, 0x30, 0x02, 0x00, 0x0d, 0x00, 0x0a, 0x00, 0x0d,
     0x00, 0x0a, 0x76, 0xee, 0x52, 0x4d, 0xff, 0x0c, 0x8f, 0xd9, 0x4e, 0x2a,
     0x54, 0x08, 0x8d, 0x44, 0x51, 0x6c, 0x53, 0xf8, 0x8f, 0xd8, 0x59, 0x04,
     0x4e, 0x8e, 0x7b, 0x79, 0x59, 0x07, 0x96, 0x36, 0x6b, 0xb5, 0xff, 0x0c,
     0x51, 0x73, 0x4e, 0x8e, 0x51, 0x6c, 0x53, 0xf8, 0x54, 0x0d, 0x79, 0xf0,
     0x30, 0x01, 0x8d, 0x1f, 0x8d, 0x23, 0x4e, 0xba, 0x30, 0x01, 0x6b, 0x63,
     0x5f, 0x0f, 0x62, 0x10, 0x7a, 0xcb, 0x76, 0x84, 0x65, 0xf6, 0x95, 0xf4,
     0x30, 0x01, 0x54, 0x08, 0x4f, 0x5c, 0x65, 0xb9, 0x7b, 0x49, 0x7e, 0xc6,
     0x82, 0x82, 0xff, 0x0c, 0x8f, 0xd8, 0x67, 0x2a, 0x88, 0xab, 0x90, 0x0f,
     0x97, 0x32, 0x30, 0x02, 0x00, 0x0d, 0x00, 0x0a, 0x00, 0x0d, 0x00, 0x0a,
     0x91, 0x77, 0x6d, 0x3e, 0x65, 0xb9, 0x97, 0x62, 0x79, 0xf0, 0xff, 0x0c,
     0x8b, 0xe5, 0x51, 0x6c, 0x53, 0xf8, 0x80, 0x54, 0x54, 0x08, 0x6e, 0x20,
     0x90, 0x53, 0x55, 0x46, 0x51, 0x71, 0x54, 0x0c, 0x62, 0x95, 0x8d, 0x44,
     0x53, 0xc2, 0x80, 0xa1, 0x30, 0x01, 0x62, 0x10, 0x7a, 0xcb, 0x54, 0x08,
     0x8d, 0x44, 0x51, 0x6c, 0x53, 0xf8, 0xff, 0x0c, 0x57, 0x28, 0x4e, 0x00,
     0x5b, 0x9a, 0x7a, 0x0b, 0x5e, 0xa6, 0x4e, 0x0a, 0x66, 0x2f, 0x57, 0xfa,
     0x4e, 0x8e, 0x76, 0xee, 0x52, 0x4d, 0x8f, 0xd0, 0x84, 0x25, 0x55, 0x46,
     0x88, 0x65, 0x8d, 0x34, 0x52, 0x9b, 0x5e, 0xa6, 0x4e, 0x0b, 0x8c, 0x03,
     0x7b, 0x49, 0x65, 0x3f, 0x7b, 0x56, 0x53, 0xd8, 0x53, 0x16, 0x4e, 0x0b,
     0x76, 0x84, 0x5e, 0x94, 0x5b, 0xf9, 0x4e, 0x3e, 0x63, 0xaa, 0x30, 0x02,
     0x00, 0x0d, 0x00, 0x0a, 0x00, 0x0d, 0x00, 0x0a, 0x4e, 0x0e, 0x6d, 0x77,
     0x59, 0x16, 0x5e, 0x02, 0x57, 0x3a, 0x76, 0xf8, 0x6b, 0xd4, 0xff, 0x0c,
     0x4e, 0x2d, 0x56, 0xfd, 0x76, 0x84};

TT_TEST_ROUTINE_DEFINE(case_charset_utf16be_utf8)
{
    // tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);
    tt_result_t ret;
    tt_chsetconv_t csconv;

    TT_TEST_CASE_ENTER()
// test start

#if TT_ENV_OS_IS_ANDROID
    return TT_SUCCESS;
#endif

    // utf16be to utf8
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF16BE, TT_CHARSET_UTF8, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf8[sizeof(__utf8_1)];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8);

        ret = tt_chsetconv_input(&csconv, __utf16be_1, sizeof(__utf16be_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, sizeof(__utf8_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf8, __utf8_1, ret_utf8_len), 0, "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }

    // utf16be to utf8: incomplete
    {
        tt_u8_t test_1[] = {0x7f,
                            0x51,
                            0x66,
                            0x13,
                            0x79,
                            0xd1,
                            0x62,
                            0x80,
                            0xD8,
                            0x01,
                            0xDC,
                            0x37,
                            0x8b,
                            0xaf};
        tt_u8_t test_ret[] = {0xe7,
                              0xbd,
                              0x91,
                              0xe6,
                              0x98,
                              0x93,
                              0xe7,
                              0xa7,
                              0x91,
                              0xe6,
                              0x8a,
                              0x80,
                              0xf0,
                              0x90,
                              0x90,
                              0xb7,
                              0xe8,
                              0xae,
                              0xaf};
        tt_u8_t ret_utf8[10];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8), i, j;

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 1 utf8
        ret = tt_chsetconv_input(&csconv, test_1 + 1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xBd, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");

        // 1 utf8
        ret = tt_chsetconv_input(&csconv, test_1 + 2, 3);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe6, "");
        TT_UT_EQUAL(ret_utf8[1], 0x98, "");
        TT_UT_EQUAL(ret_utf8[2], 0x93, "");

        // 2 utf8
        ret = tt_chsetconv_input(&csconv, test_1 + 5, 4);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 6, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xA7, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");
        TT_UT_EQUAL(ret_utf8[3], 0xe6, "");
        TT_UT_EQUAL(ret_utf8[4], 0x8A, "");
        TT_UT_EQUAL(ret_utf8[5], 0x80, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1 + 9, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        ret = tt_chsetconv_input(&csconv, test_1 + 10, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 2 utf
        ret = tt_chsetconv_input(&csconv, test_1 + 11, 3);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 7, "");
        TT_UT_EQUAL(ret_utf8[0], 0xF0, "");
        TT_UT_EQUAL(ret_utf8[1], 0x90, "");
        TT_UT_EQUAL(ret_utf8[2], 0x90, "");
        TT_UT_EQUAL(ret_utf8[3], 0xB7, "");
        TT_UT_EQUAL(ret_utf8[4], 0xe8, "");
        TT_UT_EQUAL(ret_utf8[5], 0xAE, "");
        TT_UT_EQUAL(ret_utf8[6], 0xAF, "");

        // no more
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);

        // random test
        i = 0;
        j = 0;
        while (i < sizeof(test_1)) {
            tt_u32_t n = tt_rand_u32() % 3 + 1;
            if (i + n > sizeof(test_1)) {
                n = sizeof(test_1) - i;
            }

            ret = tt_chsetconv_input(&csconv, test_1 + i, n);
            TT_UT_EQUAL(ret, TT_SUCCESS, "");

            ret_utf8_len = sizeof(ret_utf8);
            tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
            if (ret_utf8_len != 0) {
                TT_UT_EQUAL(tt_memcmp(ret_utf8, test_ret + j, ret_utf8_len),
                            0,
                            "");
                j += ret_utf8_len;
            }

            i += n;
        }

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // utf8 to utf16le
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF8, TT_CHARSET_UTF16BE, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf16be[sizeof(__utf16be_1)];
        tt_u32_t ret_utf16be_len = sizeof(ret_utf16be);

        ret = tt_chsetconv_input(&csconv, __utf8_1, sizeof(__utf8_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf16be, &ret_utf16be_len);
        TT_UT_EQUAL(ret_utf16be_len, sizeof(__utf16be_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf16be, __utf16be_1, ret_utf16be_len),
                    0,
                    "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf16be, &ret_utf16be_len);
        TT_UT_EQUAL(ret_utf16be_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // test end
    TT_TEST_CASE_LEAVE()
}

static tt_u8_t __utf32le_1[] =
    {0x51, 0x7f, 0x00, 0x00, 0x13, 0x66, 0x00, 0x00, 0xd1, 0x79, 0x00, 0x00,
     0x80, 0x62, 0x00, 0x00, 0xaf, 0x8b, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
     0x39, 0x00, 0x00, 0x00, 0x08, 0x67, 0x00, 0x00, 0x31, 0x00, 0x00, 0x00,
     0x37, 0x00, 0x00, 0x00, 0xe5, 0x65, 0x00, 0x00, 0x88, 0x6d, 0x00, 0x00,
     0x6f, 0x60, 0x00, 0x00, 0x0c, 0xff, 0x00, 0x00, 0x51, 0x7f, 0x00, 0x00,
     0x13, 0x66, 0x00, 0x00, 0xd1, 0x79, 0x00, 0x00, 0x80, 0x62, 0x00, 0x00,
     0xce, 0x4e, 0x00, 0x00, 0x87, 0x5b, 0x00, 0x00, 0x99, 0x9f, 0x00, 0x00,
     0x77, 0x91, 0x00, 0x00, 0x3e, 0x6d, 0x00, 0x00, 0x85, 0x51, 0x00, 0x00,
     0xe8, 0x90, 0x00, 0x00, 0xb7, 0x83, 0x00, 0x00, 0x89, 0x60, 0x00, 0x00,
     0x0c, 0xff, 0x00, 0x00, 0x77, 0x91, 0x00, 0x00, 0x3e, 0x6d, 0x00, 0x00,
     0x06, 0x5c, 0x00, 0x00, 0x54, 0x80, 0x00, 0x00, 0x08, 0x54, 0x00, 0x00,
     0x20, 0x6e, 0x00, 0x00, 0x53, 0x90, 0x00, 0x00, 0x46, 0x55, 0x00, 0x00,
     0x95, 0x62, 0x00, 0x00, 0x44, 0x8d, 0x00, 0x00, 0x31, 0x00, 0x00, 0x00,
     0x30, 0x00, 0x00, 0x00, 0xbf, 0x4e, 0x00, 0x00, 0x43, 0x51, 0x00, 0x00,
     0xc4, 0x7e, 0x00, 0x00, 0xfa, 0x5e, 0x00, 0x00, 0x08, 0x54, 0x00, 0x00,
     0x44, 0x8d, 0x00, 0x00, 0x6c, 0x51, 0x00, 0x00, 0xf8, 0x53, 0x00, 0x00,
     0x0c, 0xff, 0x00, 0x00, 0xa0, 0x52, 0x00, 0x00, 0x1f, 0x90, 0x00, 0x00,
     0x03, 0x5e, 0x00, 0x00, 0x40, 0x5c, 0x00, 0x00, 0x3e, 0x79, 0x00, 0x00,
     0x1a, 0x4f, 0x00, 0x00, 0x6c, 0x51, 0x00, 0x00, 0x00, 0x5f, 0x00, 0x00,
     0x20, 0x6e, 0x00, 0x00, 0x53, 0x90, 0x00, 0x00, 0x0c, 0xff, 0x00, 0x00,
     0xfa, 0x5e, 0x00, 0x00, 0xcb, 0x7a, 0x00, 0x00, 0x82, 0x53, 0x00, 0x00,
     0x46, 0x55, 0x00, 0x00, 0x00, 0x4e, 0x00, 0x00, 0x53, 0x4f, 0x00, 0x00,
     0x16, 0x53, 0x00, 0x00, 0x20, 0x6e, 0x00, 0x00, 0x53, 0x90, 0x00, 0x00,
     0xd0, 0x8f, 0x00, 0x00, 0x25, 0x84, 0x00, 0x00, 0xb0, 0x65, 0x00, 0x00,
     0x21, 0x6a, 0x00, 0x00, 0x0f, 0x5f, 0x00, 0x00, 0x02, 0x30, 0x00, 0x00,
     0x0d, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00,
     0x0a, 0x00, 0x00, 0x00, 0xee, 0x76, 0x00, 0x00, 0x4d, 0x52, 0x00, 0x00,
     0x0c, 0xff, 0x00, 0x00, 0xd9, 0x8f, 0x00, 0x00, 0x2a, 0x4e, 0x00, 0x00,
     0x08, 0x54, 0x00, 0x00, 0x44, 0x8d, 0x00, 0x00, 0x6c, 0x51, 0x00, 0x00,
     0xf8, 0x53, 0x00, 0x00, 0xd8, 0x8f, 0x00, 0x00, 0x04, 0x59, 0x00, 0x00,
     0x8e, 0x4e, 0x00, 0x00, 0x79, 0x7b, 0x00, 0x00, 0x07, 0x59, 0x00, 0x00,
     0x36, 0x96, 0x00, 0x00, 0xb5, 0x6b, 0x00, 0x00, 0x0c, 0xff, 0x00, 0x00,
     0x73, 0x51, 0x00, 0x00, 0x8e, 0x4e, 0x00, 0x00, 0x6c, 0x51, 0x00, 0x00,
     0xf8, 0x53, 0x00, 0x00, 0x0d, 0x54, 0x00, 0x00, 0xf0, 0x79, 0x00, 0x00,
     0x01, 0x30, 0x00, 0x00, 0x1f, 0x8d, 0x00, 0x00, 0x23, 0x8d, 0x00, 0x00,
     0xba, 0x4e, 0x00, 0x00, 0x01, 0x30, 0x00, 0x00, 0x63, 0x6b, 0x00, 0x00,
     0x0f, 0x5f, 0x00, 0x00, 0x10, 0x62, 0x00, 0x00, 0xcb, 0x7a, 0x00, 0x00,
     0x84, 0x76, 0x00, 0x00, 0xf6, 0x65, 0x00, 0x00, 0xf4, 0x95, 0x00, 0x00,
     0x01, 0x30, 0x00, 0x00, 0x08, 0x54, 0x00, 0x00, 0x5c, 0x4f, 0x00, 0x00,
     0xb9, 0x65, 0x00, 0x00, 0x49, 0x7b, 0x00, 0x00, 0xc6, 0x7e, 0x00, 0x00,
     0x82, 0x82, 0x00, 0x00, 0x0c, 0xff, 0x00, 0x00, 0xd8, 0x8f, 0x00, 0x00,
     0x2a, 0x67, 0x00, 0x00, 0xab, 0x88, 0x00, 0x00, 0x0f, 0x90, 0x00, 0x00,
     0x32, 0x97, 0x00, 0x00, 0x02, 0x30, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00,
     0x0a, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00,
     0x77, 0x91, 0x00, 0x00, 0x3e, 0x6d, 0x00, 0x00, 0xb9, 0x65, 0x00, 0x00,
     0x62, 0x97, 0x00, 0x00, 0xf0, 0x79, 0x00, 0x00, 0x0c, 0xff, 0x00, 0x00,
     0xe5, 0x8b, 0x00, 0x00, 0x6c, 0x51, 0x00, 0x00, 0xf8, 0x53, 0x00, 0x00,
     0x54, 0x80, 0x00, 0x00, 0x08, 0x54, 0x00, 0x00, 0x20, 0x6e, 0x00, 0x00,
     0x53, 0x90, 0x00, 0x00, 0x46, 0x55, 0x00, 0x00, 0x71, 0x51, 0x00, 0x00,
     0x0c, 0x54, 0x00, 0x00, 0x95, 0x62, 0x00, 0x00, 0x44, 0x8d, 0x00, 0x00,
     0xc2, 0x53, 0x00, 0x00, 0xa1, 0x80, 0x00, 0x00, 0x01, 0x30, 0x00, 0x00,
     0x10, 0x62, 0x00, 0x00, 0xcb, 0x7a, 0x00, 0x00, 0x08, 0x54, 0x00, 0x00,
     0x44, 0x8d, 0x00, 0x00, 0x6c, 0x51, 0x00, 0x00, 0xf8, 0x53, 0x00, 0x00,
     0x0c, 0xff, 0x00, 0x00, 0x28, 0x57, 0x00, 0x00, 0x00, 0x4e, 0x00, 0x00,
     0x9a, 0x5b, 0x00, 0x00, 0x0b, 0x7a, 0x00, 0x00, 0xa6, 0x5e, 0x00, 0x00,
     0x0a, 0x4e, 0x00, 0x00, 0x2f, 0x66, 0x00, 0x00, 0xfa, 0x57, 0x00, 0x00,
     0x8e, 0x4e, 0x00, 0x00, 0xee, 0x76, 0x00, 0x00, 0x4d, 0x52, 0x00, 0x00,
     0xd0, 0x8f, 0x00, 0x00, 0x25, 0x84, 0x00, 0x00, 0x46, 0x55, 0x00, 0x00,
     0x65, 0x88, 0x00, 0x00, 0x34, 0x8d, 0x00, 0x00, 0x9b, 0x52, 0x00, 0x00,
     0xa6, 0x5e, 0x00, 0x00, 0x0b, 0x4e, 0x00, 0x00, 0x03, 0x8c, 0x00, 0x00,
     0x49, 0x7b, 0x00, 0x00, 0x3f, 0x65, 0x00, 0x00, 0x56, 0x7b, 0x00, 0x00,
     0xd8, 0x53, 0x00, 0x00, 0x16, 0x53, 0x00, 0x00, 0x0b, 0x4e, 0x00, 0x00,
     0x84, 0x76, 0x00, 0x00, 0x94, 0x5e, 0x00, 0x00, 0xf9, 0x5b, 0x00, 0x00,
     0x3e, 0x4e, 0x00, 0x00, 0xaa, 0x63, 0x00, 0x00, 0x02, 0x30, 0x00, 0x00,
     0x0d, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00,
     0x0a, 0x00, 0x00, 0x00, 0x0e, 0x4e, 0x00, 0x00, 0x77, 0x6d, 0x00, 0x00,
     0x16, 0x59, 0x00, 0x00, 0x02, 0x5e, 0x00, 0x00, 0x3a, 0x57, 0x00, 0x00,
     0xf8, 0x76, 0x00, 0x00, 0xd4, 0x6b, 0x00, 0x00, 0x0c, 0xff, 0x00, 0x00,
     0x2d, 0x4e, 0x00, 0x00, 0xfd, 0x56, 0x00, 0x00, 0x84, 0x76, 0x00, 0x00};

TT_TEST_ROUTINE_DEFINE(case_charset_utf32le_utf8)
{
    // tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);
    tt_result_t ret;
    tt_chsetconv_t csconv;

    TT_TEST_CASE_ENTER()
// test start

#if TT_ENV_OS_IS_ANDROID
    return TT_SUCCESS;
#endif

    // utf32le to utf8
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF32LE, TT_CHARSET_UTF8, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf8[sizeof(__utf8_1)];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8);

        ret = tt_chsetconv_input(&csconv, __utf32le_1, sizeof(__utf32le_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, sizeof(__utf8_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf8, __utf8_1, ret_utf8_len), 0, "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }

    // utf32le to utf8
    {
        tt_u8_t test_1[] = {0x51,
                            0x7f,
                            0x00,
                            0x00,
                            0x37,
                            0x04,
                            0x01,
                            0x00,
                            0xd1,
                            0x79,
                            0x00,
                            0x00};
        tt_u8_t test_ret[] =
            {0xe7, 0xbd, 0x91, 0xf0, 0x90, 0x90, 0xb7, 0xe7, 0xa7, 0x91};
        tt_u8_t ret_utf8[sizeof(__utf8_1)];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8), i, j;

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1 + 1, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 1 utf8le
        ret = tt_chsetconv_input(&csconv, test_1 + 3, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xbd, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");

        // 1 utf8le
        ret = tt_chsetconv_input(&csconv, test_1 + 5, 5);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 4, "");
        TT_UT_EQUAL(ret_utf8[0], 0xf0, "");
        TT_UT_EQUAL(ret_utf8[1], 0x90, "");
        TT_UT_EQUAL(ret_utf8[2], 0x90, "");
        TT_UT_EQUAL(ret_utf8[3], 0xb7, "");

        // 1 utf8le
        ret = tt_chsetconv_input(&csconv, test_1 + 10, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xa7, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);

        // random test
        i = 0;
        j = 0;
        while (i < sizeof(test_1)) {
            tt_u32_t n = tt_rand_u32() % 3 + 1;
            if (i + n > sizeof(test_1)) {
                n = sizeof(test_1) - i;
            }

            ret = tt_chsetconv_input(&csconv, test_1 + i, n);
            TT_UT_EQUAL(ret, TT_SUCCESS, "");

            ret_utf8_len = sizeof(ret_utf8);
            tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
            if (ret_utf8_len != 0) {
                TT_UT_EQUAL(tt_memcmp(ret_utf8, test_ret + j, ret_utf8_len),
                            0,
                            "");
                j += ret_utf8_len;
            }

            i += n;
        }

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // utf8 toutf32le
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF8, TT_CHARSET_UTF32LE, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf32le[sizeof(__utf32le_1)];
        tt_u32_t ret_utf32le_len = sizeof(ret_utf32le);

        ret = tt_chsetconv_input(&csconv, __utf8_1, sizeof(__utf8_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf32le, &ret_utf32le_len);
        TT_UT_EQUAL(ret_utf32le_len, sizeof(__utf32le_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf32le, __utf32le_1, ret_utf32le_len),
                    0,
                    "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf32le, &ret_utf32le_len);
        TT_UT_EQUAL(ret_utf32le_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // test end
    TT_TEST_CASE_LEAVE()
}

static tt_u8_t __utf32be_1[] = {
    0x00, 0x00, 0x7f, 0x51, 0x00, 0x00, 0x66, 0x13, 0x00, 0x00, 0x79, 0xd1,
    0x00, 0x00, 0x62, 0x80, 0x00, 0x00, 0x8b, 0xaf, 0x00, 0x00, 0x00, 0x20,
    0x00, 0x00, 0x00, 0x39, 0x00, 0x00, 0x67, 0x08, 0x00, 0x00, 0x00, 0x31,
    0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x65, 0xe5, 0x00, 0x00, 0x6d, 0x88,
    0x00, 0x00, 0x60, 0x6f, 0x00, 0x00, 0xff, 0x0c, 0x00, 0x00, 0x7f, 0x51,
    0x00, 0x00, 0x66, 0x13, 0x00, 0x00, 0x79, 0xd1, 0x00, 0x00, 0x62, 0x80,
    0x00, 0x00, 0x4e, 0xce, 0x00, 0x00, 0x5b, 0x87, 0x00, 0x00, 0x9f, 0x99,
    0x00, 0x00, 0x91, 0x77, 0x00, 0x00, 0x6d, 0x3e, 0x00, 0x00, 0x51, 0x85,
    0x00, 0x00, 0x90, 0xe8, 0x00, 0x00, 0x83, 0xb7, 0x00, 0x00, 0x60, 0x89,
    0x00, 0x00, 0xff, 0x0c, 0x00, 0x00, 0x91, 0x77, 0x00, 0x00, 0x6d, 0x3e,
    0x00, 0x00, 0x5c, 0x06, 0x00, 0x00, 0x80, 0x54, 0x00, 0x00, 0x54, 0x08,
    0x00, 0x00, 0x6e, 0x20, 0x00, 0x00, 0x90, 0x53, 0x00, 0x00, 0x55, 0x46,
    0x00, 0x00, 0x62, 0x95, 0x00, 0x00, 0x8d, 0x44, 0x00, 0x00, 0x00, 0x31,
    0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x4e, 0xbf, 0x00, 0x00, 0x51, 0x43,
    0x00, 0x00, 0x7e, 0xc4, 0x00, 0x00, 0x5e, 0xfa, 0x00, 0x00, 0x54, 0x08,
    0x00, 0x00, 0x8d, 0x44, 0x00, 0x00, 0x51, 0x6c, 0x00, 0x00, 0x53, 0xf8,
    0x00, 0x00, 0xff, 0x0c, 0x00, 0x00, 0x52, 0xa0, 0x00, 0x00, 0x90, 0x1f,
    0x00, 0x00, 0x5e, 0x03, 0x00, 0x00, 0x5c, 0x40, 0x00, 0x00, 0x79, 0x3e,
    0x00, 0x00, 0x4f, 0x1a, 0x00, 0x00, 0x51, 0x6c, 0x00, 0x00, 0x5f, 0x00,
    0x00, 0x00, 0x6e, 0x20, 0x00, 0x00, 0x90, 0x53, 0x00, 0x00, 0xff, 0x0c,
    0x00, 0x00, 0x5e, 0xfa, 0x00, 0x00, 0x7a, 0xcb, 0x00, 0x00, 0x53, 0x82,
    0x00, 0x00, 0x55, 0x46, 0x00, 0x00, 0x4e, 0x00, 0x00, 0x00, 0x4f, 0x53,
    0x00, 0x00, 0x53, 0x16, 0x00, 0x00, 0x6e, 0x20, 0x00, 0x00, 0x90, 0x53,
    0x00, 0x00, 0x8f, 0xd0, 0x00, 0x00, 0x84, 0x25, 0x00, 0x00, 0x65, 0xb0,
    0x00, 0x00, 0x6a, 0x21, 0x00, 0x00, 0x5f, 0x0f, 0x00, 0x00, 0x30, 0x02,
    0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0d,
    0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x76, 0xee, 0x00, 0x00, 0x52, 0x4d,
    0x00, 0x00, 0xff, 0x0c, 0x00, 0x00, 0x8f, 0xd9, 0x00, 0x00, 0x4e, 0x2a,
    0x00, 0x00, 0x54, 0x08, 0x00, 0x00, 0x8d, 0x44, 0x00, 0x00, 0x51, 0x6c,
    0x00, 0x00, 0x53, 0xf8, 0x00, 0x00, 0x8f, 0xd8, 0x00, 0x00, 0x59, 0x04,
    0x00, 0x00, 0x4e, 0x8e, 0x00, 0x00, 0x7b, 0x79, 0x00, 0x00, 0x59, 0x07,
    0x00, 0x00, 0x96, 0x36, 0x00, 0x00, 0x6b, 0xb5, 0x00, 0x00, 0xff, 0x0c,
    0x00, 0x00, 0x51, 0x73, 0x00, 0x00, 0x4e, 0x8e, 0x00, 0x00, 0x51, 0x6c,
    0x00, 0x00, 0x53, 0xf8, 0x00, 0x00, 0x54, 0x0d, 0x00, 0x00, 0x79, 0xf0,
    0x00, 0x00, 0x30, 0x01, 0x00, 0x00, 0x8d, 0x1f, 0x00, 0x00, 0x8d, 0x23,
    0x00, 0x00, 0x4e, 0xba, 0x00, 0x00, 0x30, 0x01, 0x00, 0x00, 0x6b, 0x63,
    0x00, 0x00, 0x5f, 0x0f, 0x00, 0x00, 0x62, 0x10, 0x00, 0x00, 0x7a, 0xcb,
    0x00, 0x00, 0x76, 0x84, 0x00, 0x00, 0x65, 0xf6, 0x00, 0x00, 0x95, 0xf4,
    0x00, 0x00, 0x30, 0x01, 0x00, 0x00, 0x54, 0x08, 0x00, 0x00, 0x4f, 0x5c,
    0x00, 0x00, 0x65, 0xb9, 0x00, 0x00, 0x7b, 0x49, 0x00, 0x00, 0x7e, 0xc6,
    0x00, 0x00, 0x82, 0x82, 0x00, 0x00, 0xff, 0x0c, 0x00, 0x00, 0x8f, 0xd8,
    0x00, 0x00, 0x67, 0x2a, 0x00, 0x00, 0x88, 0xab, 0x00, 0x00, 0x90, 0x0f,
    0x00, 0x00, 0x97, 0x32, 0x00, 0x00, 0x30, 0x02, 0x00, 0x00, 0x00, 0x0d,
    0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x0a,
    0x00, 0x00, 0x91, 0x77, 0x00, 0x00, 0x6d, 0x3e, 0x00, 0x00, 0x65, 0xb9,
    0x00, 0x00, 0x97, 0x62, 0x00, 0x00, 0x79, 0xf0, 0x00, 0x00, 0xff, 0x0c,
    0x00, 0x00, 0x8b, 0xe5, 0x00, 0x00, 0x51, 0x6c, 0x00, 0x00, 0x53, 0xf8,
    0x00, 0x00, 0x80, 0x54, 0x00, 0x00, 0x54, 0x08, 0x00, 0x00, 0x6e, 0x20,
    0x00, 0x00, 0x90, 0x53, 0x00, 0x00, 0x55, 0x46, 0x00, 0x00, 0x51, 0x71,
    0x00, 0x00, 0x54, 0x0c, 0x00, 0x00, 0x62, 0x95, 0x00, 0x00, 0x8d, 0x44,
    0x00, 0x00, 0x53, 0xc2, 0x00, 0x00, 0x80, 0xa1, 0x00, 0x00, 0x30, 0x01,
    0x00, 0x00, 0x62, 0x10, 0x00, 0x00, 0x7a, 0xcb, 0x00, 0x00, 0x54, 0x08,
    0x00, 0x00, 0x8d, 0x44, 0x00, 0x00, 0x51, 0x6c, 0x00, 0x00, 0x53, 0xf8,
    0x00, 0x00, 0xff, 0x0c, 0x00, 0x00, 0x57, 0x28, 0x00, 0x00, 0x4e, 0x00,
    0x00, 0x00, 0x5b, 0x9a, 0x00, 0x00, 0x7a, 0x0b, 0x00, 0x00, 0x5e, 0xa6,
    0x00, 0x00, 0x4e, 0x0a, 0x00, 0x00, 0x66, 0x2f, 0x00, 0x00, 0x57, 0xfa,
    0x00, 0x00, 0x4e, 0x8e, 0x00, 0x00, 0x76, 0xee, 0x00, 0x00, 0x52, 0x4d,
    0x00, 0x00, 0x8f, 0xd0, 0x00, 0x00, 0x84, 0x25, 0x00, 0x00, 0x55, 0x46,
    0x00, 0x00, 0x88, 0x65, 0x00, 0x00, 0x8d, 0x34, 0x00, 0x00, 0x52, 0x9b,
    0x00, 0x00, 0x5e, 0xa6, 0x00, 0x00, 0x4e, 0x0b, 0x00, 0x00, 0x8c, 0x03,
    0x00, 0x00, 0x7b, 0x49, 0x00, 0x00, 0x65, 0x3f, 0x00, 0x00, 0x7b, 0x56,
    0x00, 0x00, 0x53, 0xd8, 0x00, 0x00, 0x53, 0x16, 0x00, 0x00, 0x4e, 0x0b,
    0x00, 0x00, 0x76, 0x84, 0x00, 0x00, 0x5e, 0x94, 0x00, 0x00, 0x5b, 0xf9,
    0x00, 0x00, 0x4e, 0x3e, 0x00, 0x00, 0x63, 0xaa, 0x00, 0x00, 0x30, 0x02,
    0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0d,
    0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x4e, 0x0e, 0x00, 0x00, 0x6d, 0x77,
    0x00, 0x00, 0x59, 0x16, 0x00, 0x00, 0x5e, 0x02, 0x00, 0x00, 0x57, 0x3a,
    0x00, 0x00, 0x76, 0xf8, 0x00, 0x00, 0x6b, 0xd4, 0x00, 0x00, 0xff, 0x0c,
    0x00, 0x00, 0x4e, 0x2d, 0x00, 0x00, 0x56, 0xfd, 0x00, 0x00, 0x76, 0x84,
};

TT_TEST_ROUTINE_DEFINE(case_charset_utf32be_utf8)
{
    // tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);
    tt_result_t ret;
    tt_chsetconv_t csconv;

    TT_TEST_CASE_ENTER()
// test start

#if TT_ENV_OS_IS_ANDROID
    return TT_SUCCESS;
#endif

    // utf32be to utf8
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF32BE, TT_CHARSET_UTF8, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf8[sizeof(__utf8_1)];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8);

        ret = tt_chsetconv_input(&csconv, __utf32be_1, sizeof(__utf32be_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, sizeof(__utf8_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf8, __utf8_1, ret_utf8_len), 0, "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }

    // utf32be to utf8
    {
        tt_u8_t test_1[] = {0x00,
                            0x00,
                            0x7f,
                            0x51,
                            0x00,
                            0x01,
                            0x04,
                            0x37,
                            0x00,
                            0x00,
                            0x79,
                            0xd1};
        tt_u8_t test_ret[] =
            {0xe7, 0xbd, 0x91, 0xf0, 0x90, 0x90, 0xb7, 0xe7, 0xa7, 0x91};
        tt_u8_t ret_utf8[sizeof(__utf8_1)];
        tt_u32_t ret_utf8_len = sizeof(ret_utf8), i, j;

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1, 1);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // not ready
        ret = tt_chsetconv_input(&csconv, test_1 + 1, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        // 1 utf8le
        ret = tt_chsetconv_input(&csconv, test_1 + 3, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xbd, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");

        // 1 utf8le
        ret = tt_chsetconv_input(&csconv, test_1 + 5, 5);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 4, "");
        TT_UT_EQUAL(ret_utf8[0], 0xf0, "");
        TT_UT_EQUAL(ret_utf8[1], 0x90, "");
        TT_UT_EQUAL(ret_utf8[2], 0x90, "");
        TT_UT_EQUAL(ret_utf8[3], 0xb7, "");

        // 1 utf8le
        ret = tt_chsetconv_input(&csconv, test_1 + 10, 2);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");
        ret_utf8_len = sizeof(ret_utf8);
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 3, "");
        TT_UT_EQUAL(ret_utf8[0], 0xe7, "");
        TT_UT_EQUAL(ret_utf8[1], 0xa7, "");
        TT_UT_EQUAL(ret_utf8[2], 0x91, "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
        TT_UT_EQUAL(ret_utf8_len, 0, "");

        tt_chsetconv_reset(&csconv);

        // random test
        ret = tt_chsetconv_create(&csconv,
                                  TT_CHARSET_UTF32BE,
                                  TT_CHARSET_UTF8,
                                  NULL);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        i = 0;
        j = 0;
        while (i < sizeof(test_1)) {
            tt_u32_t n = tt_rand_u32() % 3 + 1;
            if (i + n > sizeof(test_1)) {
                n = sizeof(test_1) - i;
            }

            ret = tt_chsetconv_input(&csconv, test_1 + i, n);
            TT_UT_EQUAL(ret, TT_SUCCESS, "");

            ret_utf8_len = sizeof(ret_utf8);
            tt_chsetconv_output(&csconv, ret_utf8, &ret_utf8_len);
            if (ret_utf8_len != 0) {
                TT_UT_EQUAL(tt_memcmp(ret_utf8, test_ret + j, ret_utf8_len),
                            0,
                            "");
                j += ret_utf8_len;
            }

            i += n;
        }

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // utf8 toutf32le
    ret =
        tt_chsetconv_create(&csconv, TT_CHARSET_UTF8, TT_CHARSET_UTF32BE, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");
    {
        tt_u8_t ret_utf32be[sizeof(__utf32be_1)];
        tt_u32_t ret_utf32be_len = sizeof(ret_utf32be);

        ret = tt_chsetconv_input(&csconv, __utf8_1, sizeof(__utf8_1));
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        tt_chsetconv_output(&csconv, ret_utf32be, &ret_utf32be_len);
        TT_UT_EQUAL(ret_utf32be_len, sizeof(__utf32be_1), "");
        TT_UT_EQUAL(tt_memcmp(ret_utf32be, __utf32be_1, ret_utf32be_len),
                    0,
                    "");

        // no more
        tt_chsetconv_output(&csconv, ret_utf32be, &ret_utf32be_len);
        TT_UT_EQUAL(ret_utf32be_len, 0, "");

        tt_chsetconv_reset(&csconv);
    }
    tt_chsetconv_destroy(&csconv);

    // test end
    TT_TEST_CASE_LEAVE()
}

TT_TEST_ROUTINE_DEFINE(case_charset_utf8)
{
    // tt_u32_t param = TT_TEST_ROUTINE_PARAM(tt_u32_t);
    tt_result_t ret;
    tt_chsetconv_t csconv;
    tt_u8_t cs_ret[10];
    tt_u32_t i;

    TT_TEST_CASE_ENTER()
    // test start

    ret = tt_chsetconv_create(&csconv, TT_CHARSET_UTF8, TT_CHARSET_UTF8, NULL);
    TT_UT_EQUAL(ret, TT_SUCCESS, "");

    i = 0;
    while (i < sizeof(__utf8_1)) {
        tt_u32_t n = tt_rand_u32() % 5 + 1;
        tt_u32_t j, k;

        if ((i + n) > sizeof(__utf8_1)) {
            n = sizeof(__utf8_1) - i;
        }

        ret = tt_chsetconv_input(&csconv, __utf8_1 + i, n);
        TT_UT_EQUAL(ret, TT_SUCCESS, "");

        i += n;

        n = sizeof(cs_ret);
        tt_chsetconv_output(&csconv, cs_ret, &n);
        if (n != 0) {
            extern tt_u32_t __utf8_len(tt_u8_t first_byte);

            j = 0;
            while (j < n) {
                // length of this utf8 char
                k = __utf8_len(cs_ret[j]);
                TT_UT_EXP(j + k <= n, "");
                j += k;
            }
        }
    }

    tt_chsetconv_reset(&csconv);
    tt_chsetconv_destroy(&csconv);

    // test end
    TT_TEST_CASE_LEAVE()
}
